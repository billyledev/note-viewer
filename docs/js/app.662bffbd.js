(function(){"use strict";var e={6612:function(e,t,s){var o=s(144),a=s(4430),i=s.n(a),n=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("app-splitter"),t("v-ons-toast",{attrs:{visible:e.visible},on:{"update:visible":function(t){e.visible=t}}},[e._v(" "+e._s(e.visible?e.active.message:"")+" ")])],1)},r=[],l=s(629),c=function(){var e=this,t=e._self._c;return t("v-ons-splitter",[t("v-ons-splitter-side",{attrs:{swipeable:"",side:"left",collapse:"",width:"80%",animation:e.md?"overlay":"reveal","swipe-target-width":e.md&&25,open:e.isOpen},on:{"update:open":function(t){e.isOpen=t}}},[t("Menu")],1),t("v-ons-splitter-content",[t("Home")],1)],1)},d=[],u=function(){var e=this,t=e._self._c;return t("v-ons-page",[t("v-ons-list",[e.rootNotes.length?t("div",[t("ons-list-header",[e._v("Root")]),e._l(e.rootNotes,(function(s){return t("ons-list-item",{key:s.id,attrs:{modifier:"chevron",tappable:""},on:{click:function(t){return e.selectNote(s.id)}}},[e._v(" "+e._s(s.title)+" ")])}))],2):e._e(),e._l(e.notesItems,(function(s){return[s.folder?t("ons-list-header",{key:`folder-${s.id}`},[e._v(" "+e._s(s.title)+" ")]):t("ons-list-item",{key:`note-${s.id}`,attrs:{modifier:"chevron",tappable:""},on:{click:function(t){return e.selectNote(s.id)}}},[e._v(" "+e._s(s.title)+" ")])]}))],2)],1)},h=[],p={name:"MenuView",computed:{...(0,l.Se)("loader",["notesItems","rootNotes"])},methods:{...(0,l.nv)("loader",["selectNote"])}},g=p,m=s(1001),f=(0,m.Z)(g,u,h,!1,null,null,null),v=f.exports,b=function(){var e=this,t=e._self._c;return t("v-ons-page",[t("input",{staticStyle:{display:"none"},attrs:{id:"file-input",type:"file",name:"name",accept:"application/zip",label:""}}),t("toolbar",e._b({},"toolbar",e.toolbarInfo,!1)),t("div",{staticClass:"flex-container"},[t("div",{staticClass:"page-center"},[t("canvas",{directives:[{name:"show",rawName:"v-show",value:e.status.shapeDBLoaded,expression:"status.shapeDBLoaded"}],attrs:{id:"note-canvas"}}),t("v-ons-row",{directives:[{name:"show",rawName:"v-show",value:e.status.shapeDBLoaded&&e.selected,expression:"status.shapeDBLoaded && selected"}]},[t("v-ons-col",[t("v-ons-icon",{staticClass:"arrow-icon",attrs:{size:"2em",icon:"ion-ios-arrow-back, material:md-arrow-left"},on:{click:function(t){return e.navigatePage(!1)}}})],1),t("v-ons-col",{staticClass:"pagination"},[e._v(e._s(e.pagination))]),t("v-ons-col",{staticClass:"arrow-right"},[t("v-ons-icon",{staticClass:"arrow-icon",attrs:{size:"2em",icon:"ion-ios-arrow-forward, material:md-arrow-right"},on:{click:function(t){return e.navigatePage(!0)}}})],1)],1),t("v-ons-icon",{directives:[{name:"show",rawName:"v-show",value:!e.loading&&!e.status.shapeDBLoaded,expression:"!loading && !status.shapeDBLoaded"}],attrs:{size:"2em",icon:"ion-ios-document, material:md-file"},on:{click:function(t){return e.openFileDialog()}}}),t("v-ons-progress-circular",{directives:[{name:"show",rawName:"v-show",value:e.loading&&!e.status.shapeDBLoaded,expression:"loading && !status.shapeDBLoaded"}],attrs:{indeterminate:""}})],1)])],1)},w=[],x=(s(7658),s(5733)),y=s.n(x),k=function(){var e=this,t=e._self._c;return t("v-ons-toolbar",[t("div",{staticClass:"left"},[t("v-ons-toolbar-button",{on:{click:function(t){return e.$store.commit("splitter/toggle")}}},[t("v-ons-icon",{attrs:{icon:"ion-ios-menu, material:md-menu"}})],1)],1),t("div",{staticClass:"center"},[e._v(" "+e._s(e.title)+" ")])])},D=[],_={name:"ToolbarComponent",props:["title"]},B=_,S=(0,m.Z)(B,k,D,!1,null,null,null),L=S.exports,O={name:"HomeView",components:{Toolbar:L},data(){return{toolbarInfo:{title:"Note Viewer"},zip:null,worker:null,pages:null,currentPage:null,pagination:"",canvas:null,width:null,height:null,ctx:null}},computed:{...(0,l.rn)("loader",["status","loading","shapeDB","selected"])},methods:{...(0,l.nv)("loader",["startLoading","zipLoaded","badZipFile","badDatabaseFile","shapeDBLoaded","badNoteFile"]),openFileDialog(){document.getElementById("file-input").click()},loadShapeDB(){const e=this.zip.file("ShapeDatabase.db");e?e.async("uint8array").then((e=>{this.worker.postMessage({id:"openShapeDB",action:"open",buffer:e})})):this.badDatabaseFile()},parseShapeDB(e){const t=[];for(let s=0;s<e.length;s++){const o=e[s];if(0===o[25]){const e={id:o[3],folder:0===o[8],createdAt:new Date(o[1]),updatedAt:new Date(o[2]),title:o[6]};e.folder||([,,,,e.parent]=o),(e.folder||0!==o[26])&&t.push(e)}}this.shapeDBLoaded(t)},loadNote(e){const t=this.zip.file(`${e}.db`);t?t.async("uint8array").then((e=>{this.worker.postMessage({id:"openNote",action:"open",buffer:e})})):this.badNoteFile()},parseShapeModel(e){const t=e.columns.indexOf("pageUniqueId"),s=e.columns.indexOf("color"),o=e.columns.indexOf("thickness"),a=e.columns.indexOf("points"),i=e.columns.indexOf("shapeType"),n=e.values,r={};for(let d=0;d<n.length;d++){const e=n[d][t];r[e]||(r[e]={},r[e].shapes=[]);const l=(n[d][s]>>>0).toString(16).substring(2);r[e].shapes.push({color:l,thickness:n[d][o],points:n[d][a],type:n[d][i]})}this.pages=r;const l=Object.keys(r);[this.currentPage]=l,this.pagination=`1/${l.length}`;const c=this.pages[this.currentPage];this.drawPage(c)},navigatePage(e){const t=Object.keys(this.pages);let s=t.indexOf(this.currentPage);s=e?s+1:s-1,s=s<0?t.length-1:s,s=s===t.length?0:s,this.currentPage=t[s],this.pagination=`${s+1}/${t.length}`;const o=this.pages[this.currentPage];this.drawPage(o)},getValues(e,t){const s={};return s.x=e.getFloat32(t),s.y=e.getFloat32(t+4),s.pressure=e.getFloat32(t+8),s.size=e.getFloat32(t+12),s.timestamp=Number(e.getBigInt64(t+16)),s},drawPage(e){this.ctx.clearRect(0,0,this.width,this.height);for(let t=0;t<e.shapes.length;t++){const s=e.shapes[t],o=new DataView(s.points.buffer);if(this.ctx.strokeStyle=`#${s.color}`,this.ctx.lineWidth=s.thickness,-1!==[0,1,7,8].indexOf(s.type)){const e=this.getValues(o,0),t=this.getValues(o,24),a={x:this.width*e.x,y:this.height*e.y},i={x:this.width*t.x,y:this.height*t.y};switch(s.type){case 0:{const e=i.x-a.x,t=i.y-a.y,s={x:i.x-e/2,y:i.y-t/2},o=Math.abs(e/2),n=Math.abs(t/2);this.ctx.beginPath(),this.ctx.ellipse(s.x,s.y,o,n,0,0,2*Math.PI),this.ctx.stroke();break}case 1:{const e=i.x-a.x,t=i.y-a.y;this.ctx.strokeRect(a.x,a.y,e,t);break}case 7:this.ctx.beginPath(),this.ctx.moveTo(a.x,a.y),this.ctx.lineTo(i.x,i.y),this.ctx.stroke();break;case 8:{const e=a.x-i.x,t={x:i.x+2*e,y:i.y};this.ctx.beginPath(),this.ctx.moveTo(a.x,a.y),this.ctx.lineTo(i.x,i.y),this.ctx.lineTo(t.x,t.y),this.ctx.closePath(),this.ctx.stroke();break}default:break}}else{const e=s.points.length/24;this.ctx.beginPath();for(let t=0;t<e;t++){const e=this.getValues(o,24*t);0===t?this.ctx.moveTo(this.width*e.x,this.height*e.y):this.ctx.lineTo(this.width*e.x,this.height*e.y)}this.ctx.stroke()}}}},async created(){this.worker=new Worker("/note-viewer/worker.sql-wasm.js"),this.worker.onmessage=e=>{const{data:t}=e;switch(t.id){case"openShapeDB":this.worker.postMessage({id:"loadShapeDB",action:"exec",sql:"SELECT * FROM NoteModel"});break;case"loadShapeDB":{const e=t.results[0].values;this.parseShapeDB(e);break}case"openNote":this.worker.postMessage({id:"loadShapeModel",action:"exec",sql:"SELECT * FROM NewShapeModel"});break;case"loadShapeModel":this.parseShapeModel(t.results[0]);break;default:break}}},mounted(){const e=document.getElementById("file-input");e.addEventListener("change",(()=>{this.startLoading();const t=e.files[0];y().loadAsync(t).then((e=>{this.zip=e,this.zipLoaded()}),(()=>{this.badZipFile()}))})),this.canvas=document.getElementById("note-canvas"),this.ctx=this.canvas.getContext("2d");const t=window.innerWidth,s=t*(4/3);this.width=t,this.height=s,this.canvas.width=t,this.canvas.height=s},watch:{status(e){e.zipLoaded&&this.loadShapeDB()},selected(e){this.loadNote(e)}}},P=O,N=(0,m.Z)(P,b,w,!1,null,"9ece5aba",null),T=N.exports,F={name:"AppSplitter",components:{Menu:v,Home:T},computed:{isOpen:{get(){return this.$store.state.splitter.open},set(e){this.$store.commit("splitter/toggle",e)}}}},M=F,I=(0,m.Z)(M,c,d,!1,null,null,null),Z=I.exports,z={name:"App",components:{AppSplitter:Z},computed:{...(0,l.Se)("alert",["visible"]),...(0,l.rn)("alert",["active"])}},C=z,q=(0,m.Z)(C,n,r,!1,null,null,null),E=q.exports;const $=3e3,j=e=>setTimeout(e,$),V={queue:[],active:void 0,timeoutId:void 0},A={visible:e=>!!e.active},R={enqueue(e,{toast:t}){e.queue.push(t)},dequeue(e,{timeoutId:t}){const s=e.queue.shift();e.active=s,e.timeoutId=t},reset(e){const{timeoutId:t}=e;t&&clearTimeout(t),e.active=void 0,e.timeoutId=void 0}},H={pushToast({state:e,commit:t,dispatch:s},o){t("enqueue",{toast:o}),e.active||s("processQueue")},processQueue({state:e,commit:t,dispatch:s}){if(!e.queue.length&&!e.active)return;if(!e.queue.length&&e.active)return j((()=>t("reset")));const o=j((()=>s("processQueue")));t("dequeue",{timeoutId:o})}},Q={};var W={namespaced:!0,state:V,getters:A,mutations:R,actions:H,modules:Q};const J={open:!1},U={},G={toggle(e,t){e.open="boolean"===typeof t?t:!e.open}},K={},X={};var Y={namespaced:!0,state:J,getters:U,mutations:G,actions:K,modules:X};const ee={status:{},loading:!1,shapeDB:[],selected:""},te={notesItems:(e,t)=>{const{folders:s}=t;let o=[];for(let a=0;a<s.length;a++){const t={...s[a]};o.push(t);let i=e.shapeDB.filter((e=>e.parent===t.id));i=JSON.parse(JSON.stringify(i)),o=o.concat(i)}return o},folders:e=>e.shapeDB.filter((e=>e.folder)),rootNotes:e=>e.shapeDB.filter((e=>null===e.parent))},se={startLoading(e){e.loading=!0},zipLoaded(e){e.status={},e.status.zipLoaded=!0},badZipFile(e){e.status={},e.loading=!1},badDatabaseFile(e){e.status={},e.loading=!1},shapeDBLoaded(e,t){e.status={},e.status.shapeDBLoaded=!0,e.loading=!1,e.shapeDB=t},selectNote(e,t){e.selected=t,e.loading=!0}},oe={startLoading({commit:e}){e("startLoading")},zipLoaded({commit:e}){e("zipLoaded")},badZipFile({commit:e,dispatch:t}){t("alert/pushToast",{message:"Error while loading backup file!"},{root:!0}),e("badZipFile")},badDatabaseFile({commit:e,dispatch:t}){t("alert/pushToast",{message:"Error while loading notes database!"},{root:!0}),e("badDatabaseFile")},shapeDBLoaded({commit:e},t){e("shapeDBLoaded",t)},selectNote({commit:e},t){e("splitter/toggle",{},{root:!0}),e("selectNote",t)},badNoteFile({dispatch:e}){e("alert/pushToast",{message:"Error while loading this note data!"},{root:!0})}},ae={};var ie={namespaced:!0,state:ee,getters:te,mutations:se,actions:oe,modules:ae};o.ZP.use(l.ZP);var ne=new l.ZP.Store({strict:!1,namespaced:!0,state:{},getters:{},mutations:{},actions:{},modules:{alert:W,splitter:Y,loader:ie}});o.ZP.use(i()),o.ZP.config.productionTip=!1,new o.ZP({store:ne,render:e=>e(E),beforeCreate(){o.ZP.prototype.md=this.$ons.platform.isAndroid()}}).$mount("#app")}},t={};function s(o){var a=t[o];if(void 0!==a)return a.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,s),i.exports}s.m=e,function(){var e=[];s.O=function(t,o,a,i){if(!o){var n=1/0;for(d=0;d<e.length;d++){o=e[d][0],a=e[d][1],i=e[d][2];for(var r=!0,l=0;l<o.length;l++)(!1&i||n>=i)&&Object.keys(s.O).every((function(e){return s.O[e](o[l])}))?o.splice(l--,1):(r=!1,i<n&&(n=i));if(r){e.splice(d--,1);var c=a();void 0!==c&&(t=c)}}return t}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[o,a,i]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var o in t)s.o(t,o)&&!s.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};s.O.j=function(t){return 0===e[t]};var t=function(t,o){var a,i,n=o[0],r=o[1],l=o[2],c=0;if(n.some((function(t){return 0!==e[t]}))){for(a in r)s.o(r,a)&&(s.m[a]=r[a]);if(l)var d=l(s)}for(t&&t(o);c<n.length;c++)i=n[c],s.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return s.O(d)},o=self["webpackChunknote_viewer"]=self["webpackChunknote_viewer"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=s.O(void 0,[998],(function(){return s(6612)}));o=s.O(o)})();
//# sourceMappingURL=app.662bffbd.js.map